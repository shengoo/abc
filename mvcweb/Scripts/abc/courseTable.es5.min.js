"use strict";function initLesson(n){var t=$(".courseform");t.find("#kclx").html(n.CategoryName);t.find("#kcmc").html(n.CourseName);t.find("#skls").html(n.TeacherCNName+(n.TeacherEnName?"("+n.TeacherEnName+")":""));t.find("#skms").html(n.ClassModel?"自约上课":"固定上课");t.find("#sksj").html(n.ClassDate+" "+n.BeginTime+"~"+n.EndTime);t.find("#sksc").html(n.Clength+"分钟");t.find("#kcjb").html(n.LevelName);t.find("#kc").html(n.LessonNo);t.find(".oper").addClass("hidden");n.CategoryCode>=100?(t.find("tr").eq(1).addClass("hidden"),t.find("tr").eq(7).addClass("hidden")):(t.find("tr").eq(1).removeClass("hidden"),t.find("tr").eq(7).removeClass("hidden"))}function openCourseLesson(n){var o=$(n).attr("data_id"),t=scheduleLesson=window.courseLesson.filter(function(n){return n.CplId==o})[0],i,r;if(!t){webAbc.showMessage(2,"课次已取消！");return}if(scheduleLesson.CategoryCode>=100&&(scheduleLesson.CourseType=1),i=$(".courseform"),initLesson(t),i.find(".oper").removeClass("hidden"),t.ClassModel?i.find("#cancelyuyue").removeClass("hidden"):i.find("#cancelyuyue").addClass("hidden"),r=i.find(".btn"),!lessonLayer)$(".courseform .btn").on("click",function(){var n=$(this),t=n.attr("type");switch(t){case"1":inClassRoom(scheduleLesson);break;case"2":cancelYuyue(scheduleLesson.CplId,scheduleLesson.CategoryCode,function(){layer.closeAll();initSchedule(new Date)});break;case"3":searchVideoAccess(scheduleLesson.CplId,scheduleLesson.CourseType);break;case"4":searchLessonAccess(scheduleLesson.CplId)}});var u=Date.parse(new Date),f=webAbc.stringParseDate(t.ClassDate+" "+t.BeginTime+":00"),e=webAbc.stringParseDate(t.ClassDate+" "+t.EndTime+":00");r.addClass("hidden");e+18e5>u&&u>f-18e5&&r.eq(0).removeClass("hidden");f>u+72e5&&t.ClassModel&&window.parent.CurrentUser.Type=="1"&&r.eq(1).removeClass("hidden");e<u&&(r.eq(2).removeClass("hidden"),t.CategoryCode<100&&r.eq(3).removeClass("hidden"));layer.closeAll();i.css({display:"",position:"",border:"",backgroundColor:"#fff"});webAbc.openDom(i,"500px");lessonLayer=layer.index}function overschedule(){return;var n}function outschedule(){return}function initSchedule(n){var r=$(".coursetable .fullcalender"),t,i;r.html("");t=$('<div class="temp"><\/div>');r.append(t);window.courseLesson=[];i=!1;t.fullCalendar({locale:"zh-cn",header:{left:"",center:"title",right:""},defaultDate:webAbc.dateParseString(n,!0,!1),editable:!1,eventLimit:10,events:GetScheduleData(0),eventAfterAllRender:function(){if(!i){var n=$('<div class="play-btn btn_a">上一月<\/div>'),r=$('<div class="play-btn btn_b">下一月<\/div>');n.click(function(){t.fullCalendar("prev")});r.click(function(){t.fullCalendar("next")});$(".fc-center",t).prepend(n);$(".fc-center",t).append(r);i=!0;webAbc.autoAjustIframeHeight()}}})}function inClassRoom(n){webAbc.ajax({url:$.url+"/Gensee/ValidGensee",data:{CplId:n.CplId,CourseType:n.CourseType},success:function(){var t=640,i=1020;window.open($.url+"/Gensee/Gensee?CplId="+n.CplId+"&CourseType="+n.CourseType,"coursewindow","height="+t+", width="+i+", top="+($(window).height-t)/2+", left="+($(window).width-i)/2+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}})}function cancelYuyue(n,t,i){layer.confirm("您确定要取消该课程的预约？",{btn:["确定","取消"],offset:["100px"]},function(r){$.ajax({url:$.url+"/Member/CancelYuyue",dataType:"json",type:"post",data:{planId:n,categoryCode:t},success:function(n){n.Result[0].Code>0?(webAbc.showMessage(1,n.Result[0].Message),i()):webAbc.showMessage(2,n.Result[0].Message);layer.close(r)}})},function(){layer.close(index)});var r=$("#layui-layer"+layer.index);r.length&&r.css({top:window.top.scrollY+"px"})}function searchVideoAccess(n,t){$.ajax({url:$.url+"/Member/GetVideoAccess",data:{cplId:n,courseType:t},dataType:"JSON",type:"post",success:function(n){var i;if(n.Result==""){webAbc.showMessage(1,"视频正在上传中，敬请期待！");return}if(t=="1")layer.open({type:2,title:'<img src="../../Content/img/logo_new.png"  style="float:left;" height="36px" />',shadeClose:!0,shade:.5,area:["900px","543px"],content:[n.Result,"no"]});else{var u="",r=$(".videoaccess"),f=n.Result.length;if(f==0){webAbc.showMessage(1,"视频正在上传中，敬请期待！");return}for(i=0;i<f;i++)u+='<tr height="30px"><td>'+(i+1)+'<\/td><td><a class="playvideo" href="#" data-url="'+$.url+n.Result[i].DataUrl+'" >'+n.Result[i].RecordStartTime+"<\/a><\/td><\/tr>";r.find("tbody tr").remove();r.find("tbody").append($(u));webAbc.openDom(r,"600px");r.find("tbody tr").find(".playvideo").click(function(){var n=$(this).attr("data-url");webAbc.OpenPage(n)})}}})}function searchLessonAccess(n){$.ajax({url:$.url+"/Member/GetLessonAccess",data:{CplId:n},dataType:"JSON",type:"post",success:function(n){for(var r="",i=$(".lessonaccess"),t=0;t<n.TotalCount;t++)r+='<tr height="30px"><td>'+(t+1)+"<\/td><td>"+n.Data[t].LessonNo+"<\/td><td>"+n.Data[t].LessonName+'<\/td><td><a href="'+$.url+n.Data[t].FilePath+'" target="_blank">'+n.Data[t].FileName+"<\/a><\/td><\/tr>";i.find("tbody tr").remove();i.find("tbody").append($(r));webAbc.openDom(i,"600px")}})}var scheduleLesson,lessonLayer;$(function(){var n=window.parent.CurrentUser.Type;switch(n){case 1:$(".courseform .btn").eq(1).removeClass("hidden");$(".hide1").addClass("hidden");break;case 3:$(".hide3").addClass("hidden");$(".studyvoice").addClass("hidden");break;default:$(".hide4").addClass("hidden");$(".studyvoice").addClass("hidden")}window.GetScheduleData=function(t){var r=[],i=new XMLHttpRequest,u;return i.open("get",$.url+"/Member/GetScheduleByMonth?month="+t,!1),i.send(null),u=i.responseText,window.courseLesson=window.courseLesson||[],JSON.parse(u).Result.forEach(function(t){if(t.CourseCount>0){if(window.courseLesson.filter(function(n){return n.CplId==t.CplId&&n.CourseType==t.CourseType}).length>0)return;window.courseLesson.push(t);r.push({id:t.CplId,title:t.BeginTime+(n=="3"?" "+t.CategoryName:"~"+t.EndTime),start:t.ClassDate+" "+t.BeginTime,end:t.ClassDate+" "+t.EndTime})}}),r};initSchedule(new Date)});