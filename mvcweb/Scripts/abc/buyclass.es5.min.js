"use strict";function showtab(n,t){var i=window.event||t,r=i.target;$(".col_tab_ul2 li").removeClass("on");$(r).addClass("on");n==1?($(".m2eBox").eq(0).removeClass("hidden"),$(".m2eBox").eq(1).addClass("hidden")):($(".m2eBox").eq(1).removeClass("hidden"),$(".m2eBox").eq(0).addClass("hidden"))}function showMessage(n,t){var i=window.top.layer||window.layer;i?i.alert(t,{icon:n||1,title:" ",move:!1,shadeClose:!0,area:["477px","257px"],skin:"layer-ext-abccart"}):window.parent.showMessage(n,t)}var csssuit=function(){var n=($(".gift_select [class=giftcard]").length/2).toFixed();$("#label_addcard").height(140+n*35+"px");n>4?($(".col_tab_ul2").css("margin-top",10+n*35-40+"px"),$("#ContentFrame",window.parent.document).height(1800+n*35+"px"),$(".price").css("margin-top",10+(n-1)*35+"px")):($(".col_tab_ul2").css("margin-top","10px"),$(".price").css("margin-top","10px"),$("#ContentFrame",window.parent.document).height("1800px"))};$(document).ready(function(){function t(){var i=$(".tab li"),r=webAbc.getUrlQuery(window.location.search),t=null;i.click(function(){var i=this,r=$(i).attr("data"),u=i.innerHTML;t&&t[0]==i||$.ajax({url:"/BuyClass/GetCourseCard",data:{type:r,cardtypeid:window.parent.SiteType==1?1:2},dataType:"json",type:"post",success:function(r){var f,e,p,s;if(!r.IsSuccess){showMessage(2,"获取课程卡信息失败！"+r.ErrMsg);return}if(f=r.Result,f.length==0){showMessage(1,"尚未开课！敬请期待！");return}var h={title:u,img:$.url+"/Images/"+f[0].Thunm,cika:[],yueka:[]},l="",a="",v="";for(e=0;e<f.length;e++)h.cika.length==0&&(l+='<div data="1" name="type" class="course flt" ><b><\/b>次卡<\/div>'),a+='<div type="'+f[e].CardId+'" name="time"  class="course flt" ><b><\/b>'+f[e].CardName+"<\/div>",h.cika.push({CardId:f[e].CardId,category:f[e].CardName,price:f[e].Price,ClassContent:f[e].ClassContent,Discount:f[e].Discount});l+="";t&&t.removeClass("active");$(i).addClass("active");t=$(i);$(".coursetitle")[0].innerHTML=h.title;$(".courseinfo")[0].innerHTML="";$(".courseinfo").append($('<div class="clearfix"><ul class="course_ul clearfix"><li class="clearfix"><div class="hidden coursetype"><div class="course_t flt">课程类型：<\/div>'+l+"<\/div><\/li>"+(a==""?"":'<li name="1" class="clearfix"><div class="coursetype"><div class="course_t flt label-left" style="height:'+(f.length>4?"70px":"30px")+'">课程套餐<\/div>'+a+"<\/div><\/li>")+(v==""?"":'<li name="2" class="clearfix hidden" ><div class="coursetype"><div class="course_t flt label-left">课程套餐<\/div>'+v+"<\/div><\/li>")+"<\/ul><\/div>"));var y=$('.course[name="type"]'),c=null,o=null;y.click(function(){var t=this,n=$(t);o!=n&&(o&&o.removeClass("selector"),o=n,o.addClass("selector"),c&&c.addClass("hidden"),c=$('.course_ul li[name="'+o.attr("data")+'"]'),c.removeClass("hidden"),$('.course_ul li[name="'+o.attr("data")+'"] .course').eq(0).click())});p=$('.course[name="time"]');s=null;p.click(function(){var u=this,r=$(u),f=r.attr("type"),i,t;if(s!=r)for(s&&s.removeClass("selector"),s=r,s.addClass("selector"),i=o.attr("data")=="1"?h.cika:h.yueka,t=0;t<i.length;t++)if(i[t].CardId==f){n=i[t];$(".m2eBox").eq(0).html('<img style="width: 98%;height: 600px;padding-left: 10px; padding-top: 2px;" src="'+(n.ClassContent||"/assets/image/class-intro.png")+'">');$.ajax({url:$.url+"/BuyClass/GetCourseGift",type:"post",data:{cardId:i[t].CardId},success:function(n){var t="";n.IsSuccess&&n.Result.length>0?(n.Result.forEach(function(n){t+="<div class='giftcard' value='"+n.CardId+"'><b><\/b>"+n.CardName+"<\/div>"}),$(".gift").removeClass("visible")):$(".gift").addClass("visible");n.Result.length>3?$("#label_addcard").css({height:"70px"}):$("#label_addcard").css({height:"30px"});$(".gift_select").html(t);csssuit()}});$(".number_input")[0].value=1;$(".number_input")[0].style.borderColor="";$(".price_num")[0].innerHTML=n.price;break}});y.eq(0).click()}})});i.eq(r?r.action:0).click()}window.parent.scrollTo(0,0);webAbc.updateFrameHeight(1850);var n=null;$.ajax({url:$.url+"/BuyClass/GetCourseCategory",type:"post",dataType:"json",success:function(n){var u,r,i;if(!n.IsSuccess){showMessage(2,"获取课程卡种类失败！"+n.ErrMsg);return}for(u="",r=n.Result,i=0;i<r.length;i++)u+='<li data="'+r[i].Code+'">'+r[i].CategoryName+"<\/li>";$(".tab").append($(u));t()}});$(".buy").click(function(){var i=this,r=i.attributes.method.value,t;if(r=="buy"){if(t=parseInt($(".number_input")[0].value),n==null||$(".number_input")[0].style.borderColor!=""){showMessage(2,"请输入有效的购买数量！");return}webAbc.ajax({url:"/BuyClass/BuyCart",data:{cardId:n.CardId,number:t},success:function(){var n=window.top.layer||window.layer;n?n.alert("加入购物车成功！",{btn:["前去结算","继续购卡"],icon:1,title:" ",area:["477px","257px"],move:!1,shadeClose:!0,skin:"layer-ext-abccart",yes:function(){console.log("yes");n.closeAll();location.href=$.url+"/BuyClass/BuyCar"}},function(){console.log("callback");n.closeAll()}):showMessage(type,message)}})}else window.parent.CurrentUser.Type==1?location.href=$.url+"/BuyClass/BuyCar":showMessage(2,"非学员不能购卡！")});$(".plus").click(function(){$(".number_input").attr("value",parseInt($(".number_input").val())+1);$(".price_num").html(n.price*$(".number_input").val())});$(".reduce").click(function(){$(".number_input").attr("value",parseInt($(".number_input").val())-1||1);$(".price_num").html(n.price*$(".number_input").val())});$(".number_input").on("change",function(){var n=this;n.style.borderColor=/^[1-9]\d{0,2}$/.test(n.value)?"":"#f00"})});