"use strict";function OpenLayer(n){var t=window.top.layer||window.layer;t.open(n)}function initLesson(n){var t=$(".courseform");t.find("#kclx").html(n.CategoryName);t.find("#kcmc").html(n.CourseName);t.find("#skls").html(n.TeacherCNName+(n.TeacherEnName?"("+n.TeacherEnName+")":""));t.find("#skms").html(n.ClassModel?"自约上课":"固定上课");t.find("#sksj").html(n.ClassDate+" "+n.BeginTime+"~"+n.EndTime);t.find("#sksc").html(n.Clength+"分钟");t.find("#kcjb").html(n.LevelName);t.find("#kc").html(n.LessonNo);t.find(".oper").addClass("hidden");n.CategoryCode>=100?(t.find("tr").eq(1).addClass("hidden"),t.find("tr").eq(7).addClass("hidden")):(t.find("tr").eq(1).removeClass("hidden"),t.find("tr").eq(7).removeClass("hidden"))}function openCourseLesson(n){var o=$(n).attr("data_id"),t=scheduleLesson=window.courseLesson.filter(function(n){return n.CplId==o})[0],i,r;if(!t){webAbc.showMessage(2,"课次已取消！");return}if(scheduleLesson.CategoryCode>=100&&(scheduleLesson.CourseType=1),i=$(".courseform"),initLesson(t),i.find(".oper").removeClass("hidden"),t.ClassModel?i.find("#cancelyuyue").removeClass("hidden"):i.find("#cancelyuyue").addClass("hidden"),r=i.find(".btn"),!lessonLayer)$(".courseform .btn").on("click",function(){var n=$(this),t=n.attr("type");switch(t){case"1":inClassRoom(scheduleLesson);break;case"2":cancelYuyue(scheduleLesson.CplId,scheduleLesson.CategoryCode,function(){layer.closeAll();initSchedule(new Date)});break;case"3":searchVideoAccess(scheduleLesson.CplId,scheduleLesson.CourseType);break;case"4":searchLessonAccess(scheduleLesson.CplId)}});var u=Date.parse(new Date),f=webAbc.stringParseDate(t.ClassDate+" "+t.BeginTime+":00"),e=webAbc.stringParseDate(t.ClassDate+" "+t.EndTime+":00");r.addClass("hidden");e+18e5>u&&u>f-18e5&&r.eq(0).removeClass("hidden");f>u+72e5&&t.ClassModel&&window.parent.CurrentUser.Type=="1"&&r.eq(1).removeClass("hidden");e<u&&(r.eq(2).removeClass("hidden"),t.CategoryCode<100&&r.eq(3).removeClass("hidden"));layer.closeAll();i.css({display:"",position:"",border:"",backgroundColor:"#fff"});OpenLayer({type:1,title:"课次详情",closeBtn:1,shadeClose:!0,shade:.1,area:["360px","330px"],offset:["150px"],content:i});lessonLayer=layer.index}function overschedule(){return;var n}function outschedule(){return}function cancelYuyue(n,t,i){layer.confirm("您确定要取消该课程的预约？",{btn:["确定","取消"],offset:["100px"]},function(r){$.ajax({url:$.url+"/Member/CancelYuyue",dataType:"json",type:"post",data:{planId:n,categoryCode:t},success:function(n){n.Result[0].Code>0?(webAbc.showMessage(1,n.Result[0].Message),i()):webAbc.showMessage(2,n.Result[0].Message);layer.close(r)}})},function(){layer.close(index)});var r=$("#layui-layer"+layer.index);r.length&&r.css({top:window.top.scrollY+"px"})}function searchVideoAccess(n,t){$.ajax({url:$.url+"/Member/GetVideoAccess",data:{cplId:n,courseType:t},dataType:"JSON",type:"post",success:function(n){var i;if(n.Result==""){webAbc.showMessage(1,"视频正在上传中，敬请期待！");return}if(t=="1")layer.open({type:2,title:'<img src="../../Content/img/logo_new.png"  style="float:left;" height="36px" />',shadeClose:!0,shade:.5,area:["900px","543px"],content:[n.Result,"no"]});else{var u="",r=$(".videoaccess"),f=n.Result.length;if(f==0){webAbc.showMessage(1,"视频正在上传中，敬请期待！");return}for(i=0;i<f;i++)u+='<tr height="30px"><td>'+(i+1)+'<\/td><td><a class="playvideo" href="#" data-url="'+$.url+n.Result[i].DataUrl+'" >'+n.Result[i].RecordStartTime+"<\/a><\/td><\/tr>";r.find("tbody tr").remove();r.find("tbody").append($(u));OpenLayer({type:1,title:"视频录像",closeBtn:1,shadeClose:!0,shade:.1,area:["600px","auto"],content:r});r.find("tbody tr").find(".playvideo").click(function(){var n=$(this).attr("data-url");layer.open({type:2,title:'<img src="../../Content/img/logo_new.png"  style="float:left;" height="36px" />',shadeClose:!0,shade:.5,area:["900px","600px"],content:[n,"no"]})})}}})}function searchLessonAccess(n){$.ajax({url:$.url+"/Member/GetLessonAccess",data:{CplId:n},dataType:"JSON",type:"post",success:function(n){for(var r="",i=$(".lessonaccess"),t=0;t<n.TotalCount;t++)r+='<tr height="30px"><td>'+(t+1)+"<\/td><td>"+n.Data[t].LessonNo+"<\/td><td>"+n.Data[t].LessonName+'<\/td><td><a href="'+$.url+n.Data[t].FilePath+'" target="_blank">'+n.Data[t].FileName+"<\/a><\/td><\/tr>";i.find("tbody tr").remove();i.find("tbody").append($(r));OpenLayer({type:1,title:"查看课件",closeBtn:1,shadeClose:!0,shade:.1,area:["600px","auto"],content:i})}})}function setSingleForm(n){if(n&&$(".single").length){var t=$(".single input");t[0].value=n.CNName;t[1].value=n.ENName;$('.single input[name="sex"]')[n.Sex==0?1:0].checked=!0;t[4].value=webAbc.dateParseString(n.Birthday?new Date(parseInt(n.Birthday.substr(6,12))):new Date,!0,!1);t[5].value=n.Email;$("#myphone").html(n.Mobile);$(".single textarea")[0].value=n.Voice;$(".single textarea")[1].value=n.Address}}function inClassRoom(n){webAbc.ajax({url:$.url+"/Gensee/ValidGensee",data:{CplId:n.CplId,CourseType:n.CourseType},success:function(){var t=640,i=1020;window.open($.url+"/Gensee/Gensee?CplId="+n.CplId+"&CourseType="+n.CourseType,"coursewindow","height="+t+", width="+i+", top="+($(window).height-t)/2+", left="+($(window).width-i)/2+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}})}function initSchedule(n){var r=$(".coursetable .fullcalender"),t,i;r.html("");t=$('<div class="temp"><\/div>');r.append(t);window.courseLesson=[];i=!1;t.fullCalendar({locale:"zh-cn",header:{left:"",center:"title",right:""},defaultDate:webAbc.dateParseString(n,!0,!1),editable:!1,eventLimit:10,events:GetScheduleData(0),eventAfterAllRender:function(){if(!i){var n=$('<div class="play-btn btn_a">上一月<\/div>'),r=$('<div class="play-btn btn_b">下一月<\/div>');n.click(function(){t.fullCalendar("prev")});r.click(function(){t.fullCalendar("next")});$(".fc-center",t).prepend(n);$(".fc-center",t).append(r);i=!0;webAbc.autoAjustIframeHeight()}}})}var scheduleLesson,lessonLayer,index=1;$(document).ready(function(){var o=$(".side-menu a"),i,f;window.parent.$("iframe")[0]&&(window.parent.$("iframe")[0].style.height="860px",window.parent.scrollTo(0,0));i=window.parent.CurrentUser.Type;switch(i){case 1:$(".courseform .btn").eq(1).removeClass("hidden");$(".hide1").addClass("hidden");break;case 3:$(".hide3").addClass("hidden");$(".studyvoice").addClass("hidden");break;default:$(".hide4").addClass("hidden");$(".studyvoice").addClass("hidden")}$("#mycourse").find("label").click(function(){n.setActiveTab("courselist")});f=$(".phone");$("button",f).click(function(){var t=$(this),i=$("input",f),n=i[0].value,r=t.attr("method");if(r=="sendValid"){if(!n||n.length!=11){webAbc.showMessage(2,"请输入正确的电话号码！");return}parseInt(t.html())||webAbc.ajax({url:"/Home/SendValid",data:{mobile:n},success:function(){var n=60,i;webAbc.showMessage(1,"短信发送成功，请注意查收！");i=setInterval(function(){if(n==0){t.html("获取验证码");clearInterval(i);return}t.html(n--+"秒后重新发送")},1e3)}})}else webAbc.ajax({url:$.url+"/Member/UpdatePhone",data:{phone:n,code:i[1].value},type:"post",dataType:"json",success:function(){webAbc.showMessage(1,"修改绑定手机号成功！");$("#myphone").html(n);i[0].value="";i[1].value=""}})});window.GetScheduleData=function(n){var r=[],t=new XMLHttpRequest,u;return t.open("get",$.url+"/Member/GetScheduleByMonth?month="+n,!1),t.send(null),u=t.responseText,window.courseLesson=window.courseLesson||[],JSON.parse(u).Result.forEach(function(n){if(n.CourseCount>0){if(window.courseLesson.filter(function(t){return t.CplId==n.CplId&&t.CourseType==n.CourseType}).length>0)return;window.courseLesson.push(n);r.push({id:n.CplId,title:n.BeginTime+(i=="3"?" "+n.CategoryName:"~"+n.EndTime),start:n.ClassDate+" "+n.BeginTime,end:n.ClassDate+" "+n.EndTime})}}),r};var s=function(n){var i=$(".order-list",t);$(".questionanswer_item",i).remove();webAbc.ajax({url:$.url+"/Member/GetQuestionAnswer",data:{Id:n},success:function(n){if(n.length!=0){var r=n[0].IsAccept==1;webAbc.getPageSetting($(".page",t),n,6,function(u){$(".questionanswer_item",i).remove();u.forEach(function(u){var e='<div class="questionanswer_item"><table><tr><td rowspan="2" style="width:55px"><img width="50" height="50" style="margin:5px;" src="'+($.url+u.Logo||$.url+"/Images/member_default.png")+'" /><\/td><td style="width:120px">'+u.UserName+"<\/td><td>"+(r?u==n[0]?"最佳答案":"":'<a class="accept">采纳<\/a>')+'<\/td><\/tr><tr><td colspan="2">'+webAbc.dateParseString(new Date(parseInt(u.CreateTime.substr(6))))+'<\/td><\/tr><tr><td colspan="3"><div class="content">'+u.Content+"<\/div><\/td><\/tr><\/table><\/div>",f=$(e);i.append(f);f.find(".accept").click(function(){webAbc.ajax({url:$.url+"/Member/SetQuestionAnswer",data:{Id:u.AnswerId},success:function(){$(".back",t).click()}})})})})}}})},h=function(){var n=$(".myquestion");webAbc.ajax({url:"/Member/GetQuestion",success:function(i){var r=$(".order-list",n);i.length==0?(r.addClass("hidden"),$("#question_sdk").removeClass("hidden")):($("#question_sdk").addClass("hidden"),r.removeClass("hidden"),webAbc.getPageSetting($(".page",n),i,5,function(n){$(".question_item",r).remove();n.forEach(function(n){var i=$('<div class="question_item"><table><tr><td rowspan="2" style="width:55px"><img width="50" height="50" style="margin:5px;" src="'+(window.parent.CurrentUser.Logo||$.url+"/Images/member_default.png")+'" /><\/td><td>'+webAbc.dateParseString(new Date(parseInt(n.CreateTime.substr(6))))+'<\/td><\/tr><tr><td> <a class="searchAnswer">'+n.AnswerNum+'个回复<\/a><\/td><\/tr><tr><td colspan="2"><div class="content">'+n.Content+"<\/div><\/td><\/tr><\/table><\/div>");r.append(i);i.find(".searchAnswer").click(function(){t.addClass("hidden");t=$(".questionanswer");t.removeClass("hidden");$("#questionanswer",t).html(n.Content);s(n.AskId)})})}))}})},u=function(n,t){webAbc.ajax({url:$.url+"/Member/getclassplan",data:n,success:function(i){t(n,i)}})},n={singleReady:function(){if(!this.singleReadyStatu){var n=$(".single");webAbc.ajax({url:$.url+"/Member/GetMember",type:"post",dataType:"json",success:function(n){setSingleForm(n)}});n.find("input").keyup(function(){var t=$(this),i=$(this.nextSibling),r=t.attr("name"),n=t.val();t.removeClass("error");i.removeClass("error");n!=""&&(r=="name"&&(!/^\S[a-zA-Z\s\d\u4e00-\u9fa5]+\S$/.test(n)||n.length<2||n.length>6)?(i.addClass("error"),t.addClass("error")):r=="sign"&&(!/^[a-zA-Z.]+$/.test(n)||n.length<2||n.length>20)?(i.addClass("error"),t.addClass("error")):r=="nick"&&(!/^[\u4e00-\u9fa5\w]+$/.test(n)||n.length<1||n.length>20)?(i.addClass("error"),t.addClass("error")):r!="email"||/^\w{1,16}@\w{1,10}[.]+\w{1,5}$/.test(n)||(i.addClass("error"),t.addClass("error")))});n.find(".btn").click(function(){var t=n.find("input");if(t.hasClass("error")){webAbc.showMessage(2,"请输入正确的用户信息！");return}if(!t[4].value){webAbc.showMessage(2,"生日不能为空！");return}if(!t[0].value){webAbc.showMessage(2,"中文名不能为空！");return}if(!t[1].value){webAbc.showMessage(2,"英文名不能为空！");return}$("iframe").contents().find("input[type='submit']").click();webAbc.ajax({url:$.url+"/Member/SaveMember",data:{CNName:t[0].value,ENName:t[1].value,Voice:$(".single textarea").eq(0).val(),Sex:$('.single input[name="sex"]')[0].checked?1:0,Birthday:t[4].value,Email:t[5].value,Address:$(".single textarea").eq(1).val()},type:"post",dataType:"json",success:function(){window.parent.updateUser(t[1].value);webAbc.showMessage(1,"个人信息修改成功！");$("iframe").height("119px")}})});this.singleReadyStatu=!0}},singleReadyStatu:!1,safeReady:function(){this.safeReadyStatu||($(".safe input").keyup(function(){var t=$(this),n;if(t.removeClass("error"),this.value&&/^\w{6,20}$/.test(this.value)){n=$(".safe input");switch(this.name){case"pwd":return;case"newpwd":this.value==n.eq(2).val()?(n.eq(2).removeClass("error"),$(".safe .descibe").eq(1).removeClass("error")):(n.eq(2).addClass("error"),$(".safe .descibe").eq(1).addClass("error"));return;case"confirmpwd":if(this.value==n.eq(1).val()){$(".safe .descibe").eq(1).removeClass("error");return}$(".safe .descibe").eq(1).addClass("error")}}this.value&&t.addClass("error")}),$(".safe button").click(function(){var i=this,r=i.attributes.method.value,n,t;if(r=="updatePassword"){for(n=$(".safe input"),t=0;t<n.length;t++)if(n.eq(t).hasClass("error")||!n.eq(t).val())return;webAbc.ajax({url:$.url+"/Member/UpdatePassword",data:{pwd:n[0].value,newpwd:n[1].value},type:"post",dataType:"json",success:function(){webAbc.showMessage(1,"密码修改成功！");n[0].value="";n[1].value="";n[2].value=""}})}}),this.safeReadyStatu=!0)},safeReadyStatu:!1,phoneReady:function(){},myCourseCardReady:function(){var n=$(".coursecard");webAbc.ajax({url:$.url+"/Member/GetMyCourseCard",type:"post",data:Math.random(),dataType:"json",success:function(t){var i="";$.each(t,function(n,t){i+='<tr><td class="opp">'+t.RowNumber+"<\/td><td>"+t.CardNo+"<\/td><td>"+t.CategoryName+"<\/td><td>"+t.CardName+"<\/td><td>"+t.CourseName+"<\/td><td>"+t.CourseType+"<\/td><td>"+t.CardTotalNum+"<\/td><td>"+t.CardRemainderNum+"<\/td><td>"+t.ValidPeriod||"<\/td><\/tr>"});webAbc.getPageSetting($(".page",n),t,10,function(n){var i="";n.forEach(function(n){var r=t.indexOf(n);i+="<tr"+(r%2?' class="odd"':"")+'><td class="opp">'+n.RowNumber+"<\/td><td>"+n.CardNo+"<\/td><td>"+n.CategoryName+"<\/td><td>"+n.CardName+"<\/td><td>"+n.CourseName+"<\/td><td>"+n.CourseType+"<\/td><td>"+n.CardTotalNum+"<\/td><td>"+n.CardRemainderNum+"<\/td><td>"+n.ValidPeriod||"<\/td><\/tr>"});$(".coursecardbody").html(i)})}})},myCourseReadyStatu:!1,myCourseReady:function(){if(console.log("myCourseReady"),!this.myCourseReadyStatu){var r,h,o=null,f=[0,0,0],s=$(".courselist"),e=$(".classEvaluate .remark"),c=null;i==1?(webAbc.markStar({container:e,title:"教学质量",fn:function(n){f[0]=n}}),webAbc.markStar({container:e,title:"教师态度",fn:function(n){f[1]=n}}),webAbc.markStar({container:e,title:"课堂气氛",fn:function(n){f[2]=n}})):i==3&&(webAbc.markStar({container:e,title:"学习能力",fn:function(n){f[0]=n}}),webAbc.markStar({container:e,title:"学习态度",fn:function(n){f[1]=n}}),webAbc.markStar({container:e,title:"掌握程度",fn:function(n){f[2]=n}}));$(".classEvaluate .btntiny").on("click",function(){var n=$(this).attr("action"),t=$(".evaluatecontent").val();if(n=="close"){$(".layui-layer-close").click();return}if(f[0]==0||f[1]==0||f[2]==0){webAbc.showMessage(2,"请打分！");return}if(!t){webAbc.showMessage(2,"请写上您的评价！");return}webAbc.ajax({url:"/Member/CreateClassComment",data:{ClassId:r.ClassId,CplId:h.CplId,Content:$(".evaluatecontent").val(),Rate1:f[0],Rate2:f[1],Rate3:f[2],CommentType:r.CategoryCode},success:function(){webAbc.showMessage(1,"评价成功！");setTimeout(function(){layer.closeAll()},2e3)}})});var l=function(n,t){var i=$(".classEvaluate");$.ajax({url:$.url+"/Member/GetLessonComment",type:"post",data:{cplId:n,isPublic:t},dataType:"json",success:function(n){if(n.IsSuccess){n.Result?(f=[n.Result.Rate1,n.Result.Rate2,n.Result.Rate3],$(".evaluatecontent").val(n.Result.Content),$(".btntiny",i).html("关闭"),$(".btntiny",i).attr("action","close")):($(".evaluatecontent").val(""),f=[0,0,0],$(".btntiny",i).html("提交"),$(".btntiny",i).attr("action","submit"));var t=$(".rate img");$.each(f,function(n,i){for(var r=0;r<5;r++)t[r+n*5].src=r<i?$.url+"/Images/star-on.png":$.url+"/Images/star-off.png"})}else webAbc.showMessage(2,n.ErrMsg)}})},a=function(n,t){var f=n.TeacherEnName||n.TeacherCNName||"暂无分配",e=f=="暂无分配"?"-":n.ClassDate+" "+n.BeginTime+"~"+n.EndTime,u="<tr><td>"+n.LessonNo+"<\/td><td>"+f+'<\/td><td title="'+n.ManagerName+'">'+(webAbc.getCharLength(n.ManagerName)<18?n.ManagerName||"":n.ManagerName.substr(0,14)+"..")+"<\/td><td>"+n.CurrStudentNum+"/"+n.MaxStudentNum+"<\/td><td>"+e+"<\/td><td>"+n.Clength+"<\/td><td>"+n.LessonStatusName+"<\/td>";if(f!="暂无分配")switch(t){case"0":u+="<td>";i=="1"&&r.ClassModel==1&&r.CategoryCode!="1"&&(u+='<a class="btntiny" action="Yuyue">立即预约<\/a>');u+="<\/td><\/tr>";break;case"1":u+='<td style="width:200px;"><a class="btntiny" action="InClassRoom">进入教室<\/a>';i=="1"&&r.ClassModel==1&&(u+='<a class="btntiny" action="Cancel">取消约课<\/a>');r.CategoryCode<100&&(u+='<a class="btntiny" action="LessonAccess" >课件<\/a><\/td><\/tr>');break;case"2":u+="<td>";r.CategoryCode<100&&(u+='<a class="btntiny" action="LessonAccess" >课件<\/a>');(i=="1"||i=="3"&&r.CategoryCode===1)&&(u+='<a class="btntiny" action="Evaluate">评价<\/a>');u+="<\/td><\/tr>";break;default:u+="<\/tr>"}else u+=t=="3"?"<\/tr>":"<td><\/td><\/tr>";return u},v=function(t,i){t.queryType=="3"?$(".classhour th").eq(7).addClass("hidden"):$(".classhour th").eq(7).removeClass("hidden");webAbc.getPageSetting($(".classhour .page"),i,10,function(i){var r=$($(".classhour tbody")[0]);$("tr",r).remove();i.forEach(function(u){var f=$(a(u,t.queryType));f.addClass(i.indexOf(u)%2?"odd":"opp");r.append(f);console.log($(".btntiny",f));f.find(".btntiny").click(function(){var t=$(this).attr("action");h=u;switch(t){case"Yuyue":$.ajax({url:$.url+"/Member/InsertCourse",dataType:"json",type:"post",data:{planId:u.CplId,classId:u.ClassId},success:function(t){t!=null?t.Result[0].Code>0?(webAbc.showMessage(1,t.Result[0].Message),n.setActiveTab("courselist"),c.click()):webAbc.showMessage(2,t.Result[0].Message):webAbc.showMessage(2,"访问服务器异常，请重试！")}});break;case"Cancel":cancelYuyue(u.CplId,u.CategoryCode,function(){n.setActiveTab("courselist");o.click()});break;case"Evaluate":l(u.CplId,u.CategoryCode>=100);OpenLayer({type:1,title:"课程评价",closeBtn:1,shadeClose:!0,shade:0,area:["480px","360px"],content:$(".classEvaluate")});break;case"InClassRoom":console.log("InClassRoom");inClassRoom(u);break;case"LessonAccess":searchLessonAccess(u.CplId)}})});OpenLayer({type:1,title:" ",area:"900px",shadeClose:!0,content:$(".classhour")})})},y=function(n){$(".classhour li").remove();$("#coursedetail").html("&nbsp;&gt;&nbsp;"+r.CourseName);u({classType:1,queryType:n,courseType:r.CourseType,classId:r.ClassId},v)},p=function(i,u){webAbc.getPageSetting($(".page",s),u,10,function(f){var e=$("tbody",s),o;$("tr",e).remove();o=$(".courselist .nav-tabs li").eq(1).hasClass("focus");f.forEach(function(f){var h=u.indexOf(f),s=$("<tr class="+(h%2?"odd":"opp")+"><td>"+f.CategoryName+"<\/td><td>"+f.LevelName+"<\/td><td>"+f.CourseName+"<\/td><td>"+(f.ClassModel?"自约上课":"固定开课")+"<\/td><td>"+f.FinishCount+"/"+f.LessonCount+'<\/td><td style="width:200px;">'+(i.queryType=="0"&&f.CategoryCode==1?'<div class="btntiny " action="yuyue">发起预约<\/div>':"")+(f.CourseType==-1?"":(i.queryType=="0"&&f.CategoryCode==1?'<div class="btntiny " action="search">查看详情<\/div>':'<div class="btntiny " action="search">'+(o?"发起预约":"查看详情")+"<\/div>")+"<\/td><\/tr>"));e.append(s);s.find(".btntiny").click(function(){var e=$(this).attr("action"),u;r=f;switch(e){case"search":y(i.queryType);c=$(this);t.addClass("hidden");t=$(".classlesson");t.removeClass("hidden");break;case"yuyue":u=$(".courseyuyue .title");u.html('<a style="cursor:pointer">我的课程<\/a>&gt;<a>'+r.CategoryName+"&nbsp;-&nbsp;"+f.CourseName+"<a>");u.find("a").eq(0).click(function(){n.setActiveTab("courselist")});n.myCapacityReady(r.ClassId,r.CourseId);t.addClass("hidden");t=$(".courseyuyue");t.removeClass("hidden")}})});webAbc.autoAjustIframeHeight()})};if(this.myCourseReadyStatu){$(".nav-tabs li",s).eq(0).click();return}$(".nav-tabs li",s).click(function(){var n=$(this),t=n.attr("data");o&&o.removeClass("focus");o=n;o.addClass("focus");u({classType:0,queryType:t,courseType:2},p)});$(".nav-tabs li",s).eq(0).click();this.myCourseReadyStatu=!0}},myCourseReadyStatu:!1,teacherIds:"",myCapacityReady:function(t,i){var u=this,r=$(".courseyuyue"),s="1",p=1,f=null,h=null,c=$('div[action="selectTeacher"]',r),l=r.find('.selbtn[action="mode"]'),w=r.find('.selbtn[action="times"]'),b="",a=null,v=null,e=null,nt,k,d,y,o,g;webAbc.ajax({url:"/Member/GetClassTeacher",data:{classId:t},success:function(n){var t=$(".win_grid"),i=function(n){var i=$(".win_table tbody",t),r;$("tr",i).remove();r="";n.forEach(function(n){var t=$("<tr data="+n.Id+' data_name="'+n.Name+'"><td><img src="'+(n.Logo||"../../Images/member_default.png")+'" width="64px" /><\/td><td>'+(n.EnName||"")+"<\/td><td>"+(n.Signature||"")+'<\/td><td><div class="btn" style="width:80px;" >选择<\/div><\/td><\/tr>'),r=function(){u.teacherIds=n.Id;c.html(n.Name);layer.close(layer.index);e&&e.click()};t.find(".btn").click(r);i.append(t)})};i(n);t.find(".input").bind("keyup",function(){var t=this.value;i(n.filter(function(n){return n.Name.indexOf(t)>-1||n.EnName.indexOf(t)>-1||!t}))})}});nt=function(){c.html("");l.eq(0).click();w.eq(0).click();u.teacherIds="";$(".classdate",r).removeClass("selectdate");$(".choicetime",r).html("")};c.on("click",function(){OpenLayer({type:1,title:"选择老师",closeBtn:1,shadeClose:!0,shade:.1,area:["720px","540px"],content:$(".win_grid")})});for(k=function(n){var t=null,i=$(".choicetime",r);$(".classtime",i).remove();n.forEach(function(n){var r=$('<div class="classtime">'+n.valid_time_begin+"<\/div>");r.click(function(){t&&t.removeClass("selecttime");t=$(this);t.addClass("selecttime");h=n.valid_time_begin;s=="1"&&(u.teacherIds=n.teacher_ids.join(","))});i.append(r)})},d=function(){if(s=="2"&&u.teacherIds==""){webAbc.showMessage(2,"请选择老师！");return}var n=layer.load(1,{shade:[.1,"#fff"],offset:["290px"]}),r=u.teacherIds;$.ajax({url:$.url+"/Member/GetCourseTeachers",type:"post",data:{courseId:i,classId:t,teacherIds:u.teacherIds,bookDate:f,courseCount:p},dataType:"json",success:function(t){layer.close(n);var i=[];t!=null&&t.Data!=null&&t.Result[0].Code>0&&(i=t.Data);t&&t.Result[0].Code<1?webAbc.showMessage(2,t.Result[0].Message):i.length==0&&webAbc.showMessage(2,"无可约时段！");k(i)}})},$('.btn[action="submit"]',r).click(function(){if(!f){webAbc.showMessage(2,"请选择上课日期！");return}if(!h){webAbc.showMessage(2,"请选择上课时段！");return}$.ajax({url:$.url+"/Member/Order",type:"post",data:{classId:t,courseId:i,beginTime:h,bookDate:f,teacherIds:u.teacherIds,courseCount:p},dataType:"json",success:function(t){t.Result[0].Code<1?webAbc.showMessage(1,t.Result[0].Message):webAbc.showMessage(1,"预约成功！");n.myCourseReadyStatu=!1;$(".choicedate .selectdate").click()}})}),l.click(function(){var n=$(this);s=n.attr("data");a&&a.removeClass("select")||l.eq(0).removeClass("select");a=n;a.addClass("select");h="";r.find(".choicetime").html("");s=="2"?(r.find(".selteacher").removeClass("hidden"),r.find(".selteacher").find(".input").html("请选择教师")):(r.find(".selteacher").addClass("hidden"),u.teacherIds="",c.html(""),l.eq(0).click());$(".classdate.selectdate").click()}),w.click(function(){var n=$(this);p=n.attr("data");v&&v.removeClass("select");v=n;v.addClass("select");$(".classdate.selectdate").click()}),w.eq(0).click(),y=1;y<8;y++)o=new Date((new Date).getTime()+y*864e5),b+='<div class="classdate flt" data="'+webAbc.dateParseString(o,!0,!1)+'">'+webAbc.getWeekDay(o.getDay())+"<br/>"+(o.getMonth()+1)+"-"+o.getDate()+"<\/div>";r.find(".choicedate").empty().append(b);g=function(n){webAbc.getPageSetting($(".page",r),n,6,function(n){$(".courseinfo",r).remove();$(".previewclass li").each(function(n,t){n!=0&&t.remove()});n.forEach(function(n){if(f==n.ClassDate&&n.CourseCount>0){var t=$('<li class="courseinfo"><div class="time flt right_border">'+(n.CategoryCode==1?"一对一课程":"一对六课程")+'<\/div><div class="coursename flt right_border">'+n.CourseName+'<\/div> <div class="class flt right_border">'+(n.ClassModel?"自约上课":"固定开课")+'<\/div><div class="coursename flt right_border">'+(n.TeacherEnName||n.TeacherCnName||"暂无分配")+'<\/div><div class="class flt right_border">'+n.BeginTime+"~"+n.EndTime+'<\/div><div class="operation flt">'+(n.ClassModel?'<div class="btntiny " style="height:18px; line-height:18px;margin-top: 8px;" >取消预约<\/div>':"")+"<\/div><\/li>");t.find(".btntiny").click(function(){var t=this;cancelYuyue(n.CplId,n.CategoryCode,function(){$(t).parent().parent().remove()})});$(".previewclass").append(t)}})})};$(".classdate",r).click(function(){e&&e.removeClass("selectdate");e=$(this);e.addClass("selectdate");f=e.attr("data");d();webAbc.ajax({url:"/Member/GetSchedule",data:{beginTime:f},success:function(n){var t=n.filter(function(n){return f==n.ClassDate&&n.CourseCount>0});g(t)}})});OpenLayer({type:1,title:" ",closeBtn:1,shadeClose:!0,shade:.1,area:"900px",content:$(".courseyuyue")});this.myCapacityReadyStatu=!0},myCapacityReadyStatu:!1,myCourseListReady:function(){initSchedule(new Date)},myEvaluateReady:function(){var n=$(".myevaluate"),r=$(".nav-tabs li",n),t="0",f,o,i=null;if(this.myEvaluateReadyStatu){r.eq(0).click();return}var h=function(n){for(var u,i,t="",r=0;r<n;r++)t+="<img src='"+$.url+"/Images/star-on.png'>";for(u=5-n,i=0;i<u;i++)t+="<img src='"+$.url+"/Images/star-off.png'>";return t},c=function(t,i,r){webAbc.ajax({url:"/Member/GetClassComment",type:"post",dataType:"json",data:{type:r},success:function(r){webAbc.getPageSetting($(".page",n),r.filter(function(n){return n.CourseType==i&&(n.CplId==t||n.ClassId==t)}),3,function(t){var i="";t.forEach(function(n){i+='<div class="evaluate_item"><table><tr><td rowspan=2 class="evaluate_photo">'+(n.Logo?'<img src="'+n.Logo+'" />':'<img src="../../Images/member_default.png" />')+"<\/td><td>授课老师:"+n.Teacher+"<\/td><td>课程名称:"+n.CourseName+'<\/td><\/tr><tr><td colspan="2">'+(n.About||"")+"<\/td><\/tr><tr><td colspan=2>评价时间:"+webAbc.dateParseString(new Date(parseInt(n.CreateTime.substr(6))))+"<\/td><td>评分:"+h(n.Remark)+"<\/td><\/tr><tr><td colspan=3 rowspan=2>"+n.Content+"<\/td><\/tr><\/table><\/div>"});i=i||'<div style="width:100%;height:80px;margin-top:100px;font-weight:bold;text-align:center;"><div style="margin-top:10px;">暂无评价<\/div><\/div>';$(".order-list",n).html(i)})}})},s=$(".courselist_table_container",n),e=$(".classhour",n),l=$(".orderlist",n);u({classType:0,queryType:2,courseType:2},function(n,i){i=i.filter(function(n){return n.CourseType!=-1});webAbc.getPageSetting($(".page",s),i,10,function(n){var i=$("tbody",s);$("tr",i).remove();n.forEach(function(s){var h=$('<tr class="'+(n.indexOf(s)%2?"odd":"")+'"><td>'+s.CategoryName+"<\/td><td>"+s.LevelName+"<\/td><td>"+s.CourseName+"<\/td><td>"+(s.ClassModel?"自约上课":"固定开课")+"<\/td><td>"+s.FinishCount+"/"+s.LessonCount+'<\/td><td><div class="btntiny " action="search">查看详情<\/div><\/td><\/tr>');i.append(h);h.find(".btntiny").click(function(){f=s;u({classType:1,queryType:2,courseType:s.CourseType,classId:s.ClassId},function(n,i){webAbc.getPageSetting($(".page",e),i,10,function(n){var i=$("tbody",e);$("tr",i).remove();n.forEach(function(u){var c=u.TeacherEnName||u.TeacherCNName||"暂无分配",a=c=="暂无分配"?"-":u.ClassDate+" "+u.BeginTime+"~"+u.EndTime,e='<tr class="'+(n.indexOf(u)%2?"odd":"")+'"><td>'+u.LessonNo+"<\/td><td>"+c+'<\/td><td title="'+u.ManagerName+'">'+(webAbc.getCharLength(u.ManagerName)<18?u.ManagerName||"":u.ManagerName.substr(0,14)+"..")+"<\/td><td>"+u.CurrStudentNum+"/"+u.MaxStudentNum+"<\/td><td>"+a+"<\/td><td>"+u.Clength+"<\/td><td>"+u.LessonStatusName+"<\/td>",h;(t=="0"||t=="1"&&f.CategoryCode===1)&&(e+='<td><a class="btntiny" action="Evaluate">查看评价<\/a><\/td>');e+="<\/td><\/tr>";h=$(e);i.append(h);h.find(".btntiny").click(function(){console.log("click2");var n=$(this).attr("action");o=u;r.eq(0).click();OpenLayer({type:1,title:s.CourseName,area:"600px",shadeClose:!0,content:l})})})})});console.log("click");OpenLayer({type:1,title:s.CourseName,area:"900px",shadeClose:!0,content:e})});console.log("add click")})})});r.on("click",function(){i&&i.removeClass("focus");i=$(this);i.addClass("focus");t=$(this).attr("data");c(o.CplId,f.CourseType,t)});this.myEvaluateReadyStatu=!0},myEvaluateReadyStatu:!1,myOrderReady:function(){var t=$(".orderform"),r=$(".tab li",t),i;if(webAbc.ajax({url:"getorders",success:function(n){window.orders=n;r.eq(0).click()}}),!this.myOrderReadyStatus){this.myOrderReadyStatus=!0;r.on("click",function(){var f=$(this),r=f.attr("data"),e=[],u;i&&i.removeClass("active");i=f;i.addClass("active");window.orders&&window.orders.forEach(function(n){(r=="0"||!n.TradeNo&&r=="1"||n.TradeNo&&r=="2")&&e.push(n)});u=function(n){var i="",r=n[0],u=0,t;for(i+='<div class="order-item" style="height:'+(40+32*n.length)+'px"><div class="order-item-title"><div class="date">'+webAbc.dateParseString(new Date(parseInt(r.OrderTime.substr(6))),!0,!0)+'<\/div><div class="no">订单号：<\/div><div class="trade">'+r.No+'<\/div><\/div><table class="order-body" >';n.length>0;)t=n.shift(),i+='<tr><td class="order-body-name" >'+t.CardName+'<\/td><td class="order-body-category" >'+t.Category+'<\/td><td class="order-body-name" >'+t.CourseName+'<\/td><td class="order-body-price" >'+t.Amount+'<\/td><td class="order-body-qty" >'+t.Qty+"<\/td><\/tr>",u+=t.Price;return i+('<\/table><div class="order-item-total">'+u+'<\/div><div class="order-item-operation">'+(r.TradeNo?"":'<a class="operation btn" data="'+t.No+'" action="zhifu">支付<\/a><a class="operation btn" data="'+t.No+'" action="quxiao">取消<\/a>')+"<\/div><\/div>")};webAbc.getPageSetting($(".page",t),e,8,function(i){var f="",r=[];i.forEach(function(n){r.length==0||r[0].No==n.No?r.push(n):(f+=u(r),r.push(n))});f+=r.length>0?u(r):"";$(".order-list",t).html(f);$("a[action]",t).click(function(){var t=$(this),i=t.attr("action"),r=t.attr("data");i=="zhifu"?window.location.href=$.url+"/BuyClass/BuyCarSubmit?orderNo="+r:i=="quxiao"&&$.ajax({url:$.url+"/Member/cancelorder",type:"post",dataType:"json",data:{orderNo:r},success:function(t){t.IsSuccess?(webAbc.showMessage(1,"订单取消成功！"),n.myOrderReady()):webAbc.showMessage(2,t.ErrMsg)}})})})})}},myOrderReadyStatus:!1,myQuestionReady:function(){i==1&&(window.parent.$(".nav li").eq(4).find("a").click(),window.location.href="/Free/Free")},myQuestionReadyStatus:!1,myAnswerReady:function(){if(membertype==3){var n=$(".myanswer");$.ajax({url:$.url+"/member/getanswer",type:"post",datatype:"json",success:function(t){if(t.issuccess){var i=t.result;webabc.getpagesetting($(".page",n),i,5,function(t){var i="";t.foreach(function(n){i+='<div class="answer_item"><div class="question">'+n.username+":&nbsp;&nbsp;"+n.ask+'<\/div><div class="answer">'+n.content+'<\/div><div class="sign">'+webabc.dateparsestring(new date(parseint(n.createtime.substr(6))))+"<\/div><\/div>"});$(".order-list",n).html(i)})}else webabc.showmessage(2,res.errmsg)}})}membertype==1&&window.parent.$(".nav li").eq(4).click()},setActiveTab:function(i){var f=$('a[action="'+i+'"]'),u=f.parent();r&&(r.removeClass("user-info-nav"),r.removeClass("current-sub-nav"),r.addClass("message-center-nav"),t.addClass("hidden"));u.removeClass("message-center-nav");u.addClass("user-info-nav");u.addClass("current-sub-nav");r=u;t=$("."+i);t.removeClass("hidden");i=="single"&&n.singleReady();i=="safe"&&n.safeReady();i=="phone"&&n.phoneReady();i=="coursecard"&&n.myCourseCardReady();i=="courselist"&&n.myCourseReady();i=="coursetable"&&n.myCourseListReady();i=="orderform"&&n.myOrderReady();i=="myevaluate"&&n.myEvaluateReady();i=="myquestion"&&n.myQuestionReady();i=="myanswer"&&n.myAnswerReady()}},r=null,t=null,e=webAbc.getUrlQuery(window.location.search);o.click(function(){var t=$(this).attr("action");n.setActiveTab(t)});n.setActiveTab(e?e.action:"single");window.member=n});